# Environment Variables Configuration for Real-time GPS Tracking

## Copy this to your .env file

```bash
# Google Maps API Configuration
VITE_GOOGLE_MAPS_API_KEY=your_api_key_here

# Optional: Set default map center for your city
# (Default is Delhi, India)
VITE_MAP_CENTER_LAT=28.7041
VITE_MAP_CENTER_LNG=77.1025

# Optional: Set default zoom level
VITE_MAP_DEFAULT_ZOOM=13

# Real-time Tracking Settings
VITE_TRACKING_UPDATE_INTERVAL=5000
VITE_TRACKING_MAX_HISTORY_POINTS=100

# Nearby Buses Search Radius (in km)
VITE_NEARBY_RADIUS_KM=5

# Database Connection (should already be set)
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_key
```

## Step-by-Step Setup

### 1. Get Google Maps API Key

```bash
# Option A: Manual Setup
- Go to https://console.cloud.google.com/
- Create New Project
- Search for "Maps JavaScript API"
- Enable the API
- Go to Credentials → Create API Key
- Restrict to HTTP referrers
- Copy the key
```

### 2. Add to .env

```bash
# .env file in project root
VITE_GOOGLE_MAPS_API_KEY=AIzaSyD_Sn_W0P1K_8v9_a1b2c3d4e5f6g7h8i9j
```

### 3. Update index.html (if needed)

Add this to the `<head>` section of `index.html`:

```html
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=marker,geometry,drawing,places"></script>
```

Or let the component load it dynamically from the config.

### 4. Verify Setup

```bash
# Run the app
npm run dev

# Test by visiting:
# http://localhost:5173/bus/test-bus-id/tracking
```

## Google Maps API Libraries

The following libraries are loaded with the API:

- `marker` - Advanced marker support
- `geometry` - Geometric calculations
- `drawing` - Drawing tools
- `places` - Places search

## Optional Environment Variables

```bash
# Custom Map Styling
VITE_MAP_STYLE=light_mode

# Enable/Disable Features
VITE_ENABLE_LOCATION_TRACKING=true
VITE_ENABLE_ROUTE_DRAWING=true
VITE_ENABLE_NEARBY_BUSES=true

# Performance Settings
VITE_LOCATION_HISTORY_LIMIT=50
VITE_AUTO_REFRESH_ENABLED=true
VITE_AUTO_REFRESH_INTERVAL=5000

# Debug Mode
VITE_DEBUG_GPS_TRACKING=false
VITE_DEBUG_MAP_RENDERING=false
```

## Common Google Maps API Errors

### 1. "The Google Maps Platform rejected your request"
- ✓ Check API key is correct
- ✓ Check API is enabled in Google Cloud Console
- ✓ Check billing is enabled
- ✓ Check domain restrictions

### 2. "This page can't load Google Maps correctly"
- ✓ Check VITE_GOOGLE_MAPS_API_KEY in .env
- ✓ Verify script tag in index.html
- ✓ Check browser console for specific error

### 3. "Authorization failure on Censys"
- ✓ Regenerate API key
- ✓ Check domain is not restricted
- ✓ Verify Maps JavaScript API is enabled

## Security Best Practices

```bash
# DO:
✓ Restrict API key to your domain(s)
✓ Restrict API key to specific APIs
✓ Rotate keys periodically
✓ Store keys in .env (never commit)
✓ Use separate keys for dev/staging/production

# DON'T:
✗ Expose API key in public repositories
✗ Use unrestricted API keys
✗ Share API keys across projects
✗ Hardcode API keys in source code
✗ Use same key everywhere
```

## Testing Without API Key

For testing/development without a real API key:

```tsx
// In src/components/BusMap.tsx
// The component will show a helpful message if API key is missing

// Or add mock data:
const mockLocation = {
  busId: "BUS-101",
  latitude: 28.7041,
  longitude: 77.1025,
  speed: 30,
  direction: 90,
  timestamp: new Date(),
};
```

## Deployment Considerations

### For Vercel/Netlify:
```bash
# Add environment variables in deployment settings:
VITE_GOOGLE_MAPS_API_KEY=your_production_key
VITE_MAP_CENTER_LAT=your_city_lat
VITE_MAP_CENTER_LNG=your_city_lng
```

### For Docker:
```dockerfile
FROM node:18

# Build args
ARG VITE_GOOGLE_MAPS_API_KEY
ARG VITE_SUPABASE_URL
ARG VITE_SUPABASE_ANON_KEY

ENV VITE_GOOGLE_MAPS_API_KEY=$VITE_GOOGLE_MAPS_API_KEY
ENV VITE_SUPABASE_URL=$VITE_SUPABASE_URL
ENV VITE_SUPABASE_ANON_KEY=$VITE_SUPABASE_ANON_KEY

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
```

### For GitHub Actions:
```yaml
- name: Build with env vars
  env:
    VITE_GOOGLE_MAPS_API_KEY: ${{ secrets.GOOGLE_MAPS_API_KEY }}
    VITE_SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
    VITE_SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
  run: npm run build
```

## Verify Your Setup

Run this command to verify the environment:

```bash
# Check if API key is set
echo $VITE_GOOGLE_MAPS_API_KEY

# Verify Supabase connection
npm run dev
# Then open browser and check console
```

## Quick Checklist

- [ ] Google Maps API key generated
- [ ] `.env` file created with all keys
- [ ] `.env` added to `.gitignore`
- [ ] `index.html` script tag updated (if needed)
- [ ] Database migrations run
- [ ] Supabase real-time enabled
- [ ] npm packages installed
- [ ] App starts without errors
- [ ] Can see map on `/bus/{id}/tracking`
- [ ] Location updates work in real-time

---

Need help? Check LIVE_TRACKING_SETUP.md for detailed setup instructions!
